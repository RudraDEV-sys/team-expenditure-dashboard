<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinSync - OAuth Callback</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="spinner"></div>
        <p>Processing authentication...</p>
    </div>

    <script>
        const CONFIG = {
            CLIENT_ID: '1000.54ICUD9TBU1PMJVUPB6586AT2UJ9NG',
            REDIRECT_URI: 'https://rudradev-sys.github.io/team-expenditure-dashboard/callback.html'
        };

        // For implicit flow, token comes in URL hash, not query params
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const access_token = params.get('access_token');
        const expires_in = params.get('expires_in');
        const error = params.get('error');

        console.log('Hash:', hash);
        console.log('Access Token:', access_token);
        console.log('Error:', error);

        if (error) {
            document.body.innerHTML = `
                <div class="container">
                    <h2 class="error">❌ Authorization Failed</h2>
                    <p>Error: ${error}</p>
                    <p>${params.get('error_description') || ''}</p>
                    <button onclick="authorize()">Try Again</button>
                </div>
            `;
        } else if (access_token) {
            localStorage.setItem('zoho_access_token', access_token);
            localStorage.setItem('zoho_token_expiry', Date.now() + (parseInt(expires_in) * 1000));
            
            console.log('Token saved successfully');
            
            document.body.innerHTML = `
                <div class="container">
                    <h2 class="success">✅ Authorization Successful!</h2>
                    <p>Your access token has been saved.</p>
                    <p>Redirecting to dashboard...</p>
                </div>
            `;
            
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        } else {
            document.body.innerHTML = `
                <div class="container">
                    <h2 class="error">❌ No Authorization Data</h2>
                    <p>No access token received from Zoho.</p>
                    <button onclick="authorize()">Start Authorization</button>
                </div>
            `;
        }

        function authorize() {
            const authUrl = `https://accounts.zoho.com/oauth/v2/auth?` +
                `scope=ZohoCliq.StorageData.ALL&` +
                `client_id=${CONFIG.CLIENT_ID}&` +
                `response_type=token&` +
                `redirect_uri=${encodeURIComponent(CONFIG.REDIRECT_URI)}`;
            
            window.location.href = authUrl;
        }

        window.authorize = authorize;
    </script>
</body>
</html>
